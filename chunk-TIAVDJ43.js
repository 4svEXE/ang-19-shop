import{B as J,C as _,D as K,E as y,G as Q,I as X,J as Y,K as f,L as Z,M as D,N as ee,P as te,u as F,v as q,y as z,z as H}from"./chunk-IG2CKSKY.js";import{Ea as P,Eb as u,Ec as L,Fb as i,Fc as V,Ic as k,Jc as G,Kc as $,Lb as g,Qb as N,Rb as n,Tb as d,Ub as j,a as U,aa as p,bb as s,cb as S,cc as h,dc as x,fa as E,fc as B,ga as R,h as A,lb as w,rb as v,rc as W,s as m,x as M,yb as l}from"./chunk-SGSG5N6W.js";var C=class r{auth=R(q);currentUserSig=P(null);constructor(){z(this.auth).pipe(M(e=>e?this.mapUser(e):null)).subscribe(e=>this.currentUserSig.set(e))}register(e,t,o){let a=H(this.auth,e,o).then(c=>y(c.user,{displayName:t})).then(()=>this.updateCurrentUser());return m(a)}login(e,t){let o=J(this.auth,e,t).then(()=>this.updateCurrentUser());return m(o)}logout(){let e=K(this.auth).then(()=>this.currentUserSig.set(null));return m(e)}loginWithGoogle(){let e=new F,t=_(this.auth,e).then(()=>this.updateCurrentUser());return m(t)}registerWithGoogle(){let e=new F,t=_(this.auth,e).then(o=>{let a=o.user;return a?y(a,{displayName:a.displayName}):Promise.resolve()}).then(()=>this.updateCurrentUser());return m(t)}updateCurrentUser(){let e=this.auth.currentUser;this.currentUserSig.set(e?this.mapUser(e):null)}mapUser(e){return{id:e.uid,email:e.email??"",name:e.displayName??"",createdAt:e.metadata.creationTime??"",updatedAt:e.metadata.lastSignInTime??""}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};var b=class r{constructor(e){this.firestore=e}converter(){return{toFirestore(e){return U({},e)},fromFirestore(e){return e.data()}}}getDocument(e,t){let o=f(this.firestore,e).withConverter(this.converter()),a=D(o,t);return new A(c=>{ee(a).then(I=>{c.next(I.exists()?I.data():void 0),c.complete()}).catch(I=>c.error(I))})}getCollection(e){let t=f(this.firestore,e).withConverter(this.converter());return X(t,{idField:"id"})}addDocument(e,t){let o=f(this.firestore,e).withConverter(this.converter());return Y(o,t).then(a=>a.id)}updateDocument(e,t,o){let a=f(this.firestore,e).withConverter(this.converter()),c=D(a,t);return te(c,o)}deleteDocument(e,t){let o=f(this.firestore,e),a=D(o,t);return Z(a)}static \u0275fac=function(t){return new(t||r)(E(Q))};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};var O=class r{constructor(e){this.firebaseRepository=e}collectionName="orders";createOrder(e){return this.firebaseRepository.addDocument(this.collectionName,e)}getOrders(e){return this.firebaseRepository.getCollection(this.collectionName)}getOrderById(e){return this.firebaseRepository.getDocument(this.collectionName,e)}static \u0275fac=function(t){return new(t||r)(E(b))};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};function ue(r,e){r&1&&(u(0,"div",4),n(1,` \u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0435\u043D\u043D\u044F...
`),i())}function se(r,e){if(r&1&&(u(0,"div",5),n(1),i()),r&2){let t=g();s(),d(" ",t.errorMessage,`
`)}}function ae(r,e){if(r&1&&(u(0,"div")(1,"p")(2,"strong"),n(3,"\u0406\u043C'\u044F \u043E\u0442\u0440\u0438\u043C\u0443\u0432\u0430\u0447\u0430:"),i(),n(4),i(),u(5,"p")(6,"strong"),n(7,"\u0422\u0435\u043B\u0435\u0444\u043E\u043D:"),i(),n(8),i(),u(9,"p")(10,"strong"),n(11,"\u0410\u0434\u0440\u0435\u0441\u0430:"),i(),n(12),i(),u(13,"p")(14,"strong"),n(15,"\u041F\u043E\u0448\u0442\u043E\u0432\u0438\u0439 \u043A\u043E\u0434:"),i(),n(16),i(),u(17,"p")(18,"strong"),n(19,"\u041A\u0440\u0430\u0457\u043D\u0430:"),i(),n(20),i()()),r&2){let t=g(2);s(4),d(" ",t.user.address.fullName,""),s(4),d(" ",t.user.address.phone,""),s(4),j(" ",t.user.address.address,", ",t.user.address.city,""),s(4),d(" ",t.user.address.postalCode,""),s(4),d(" ",t.user.address.country,"")}}function de(r,e){if(r&1&&(u(0,"li")(1,"p")(2,"strong"),n(3,"\u0421\u0442\u0430\u0442\u0443\u0441:"),i(),n(4),i(),u(5,"p")(6,"strong"),n(7,"\u0421\u0443\u043C\u0430:"),i(),n(8),h(9,"currency"),i(),u(10,"p")(11,"strong"),n(12,"\u0414\u0430\u0442\u0430 \u0441\u0442\u0432\u043E\u0440\u0435\u043D\u043D\u044F:"),i(),n(13),h(14,"date"),i()()),r&2){let t=e.$implicit;s(4),d(" ",t.status,""),s(4),d(" ",x(9,3,t.totalAmount),""),s(5),d(" ",x(14,5,t.createdAt),"")}}function ce(r,e){if(r&1&&(u(0,"div")(1,"ul"),v(2,de,15,7,"li",7),i()()),r&2){let t=g(2);s(2),l("ngForOf",t.orders)}}function le(r,e){r&1&&(u(0,"p"),n(1,"\u0423 \u0432\u0430\u0441 \u0449\u0435 \u043D\u0435\u043C\u0430\u0454 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u044C."),i())}function me(r,e){if(r&1&&(u(0,"div")(1,"h2"),n(2,"\u041F\u0440\u043E\u0444\u0456\u043B\u044C \u043A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430"),i(),u(3,"p")(4,"strong"),n(5,"\u0406\u043C'\u044F:"),i(),n(6),i(),u(7,"p")(8,"strong"),n(9,"Email:"),i(),n(10),i(),u(11,"p")(12,"strong"),n(13,"\u0414\u0430\u0442\u0430 \u0441\u0442\u0432\u043E\u0440\u0435\u043D\u043D\u044F \u0430\u043A\u0430\u0443\u043D\u0442\u0443:"),i(),n(14),h(15,"date"),i(),u(16,"p")(17,"strong"),n(18,"\u041E\u0441\u0442\u0430\u043D\u043D\u0456\u0439 \u0432\u0445\u0456\u0434:"),i(),n(19),h(20,"date"),i(),u(21,"h3"),n(22,"\u0410\u0434\u0440\u0435\u0441\u0430 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438"),i(),v(23,ae,21,6,"div",3),u(24,"h3"),n(25,"\u0412\u0430\u0448\u0456 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u043D\u044F"),i(),v(26,ce,3,1,"div",6)(27,le,2,0,"ng-template",null,0,B),i()),r&2){let t=N(28),o=g();s(6),d(" ",o.user.name,""),s(4),d(" ",o.user.email,""),s(4),d(" ",x(15,7,o.user.createdAt),""),s(5),d(" ",x(20,9,o.user.updatedAt),""),s(4),l("ngIf",o.user.address),s(3),l("ngIf",o.orders.length>0)("ngIfElse",t)}}var re=class r{constructor(e,t){this.authService=e;this.orderService=t;W(()=>{this.user=this.authService.currentUserSig(),this.user?(this.loadOrders(this.user.id),this.isLoading=!1):(this.errorMessage="\u041A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447 \u043D\u0435 \u0437\u043D\u0430\u0439\u0434\u0435\u043D\u0438\u0439!",this.isLoading=!1)})}user=null;orders=[];isLoading=!0;errorMessage="";loadOrders(e){this.orderService.getOrders(e).subscribe({next:t=>{this.orders=t},error:t=>{this.errorMessage="\u041F\u043E\u043C\u0438\u043B\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0435\u043D\u043D\u0456 \u0437\u0430\u043C\u043E\u0432\u043B\u0435\u043D\u044C",console.error(t)}})}static \u0275fac=function(t){return new(t||r)(S(C),S(O))};static \u0275cmp=w({type:r,selectors:[["app-me"]],decls:3,vars:3,consts:[["noOrders",""],["class","loading-spinner",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],[1,"loading-spinner"],[1,"error-message"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"]],template:function(t,o){t&1&&v(0,ue,2,0,"div",1)(1,se,2,1,"div",2)(2,me,29,11,"div",3),t&2&&(l("ngIf",o.isLoading),s(),l("ngIf",o.errorMessage),s(),l("ngIf",o.user))},dependencies:[$,L,V,G,k],encapsulation:2})};export{re as MeComponent};
